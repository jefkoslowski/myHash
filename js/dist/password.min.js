/*! password 02-07-2013 */
var PassHash=function(){};PassHash.prototype.generateHashWord=function(e){for(var a=b64_hmac_sha1(e.masterKey,e.siteTag),t=0,i=0;a.length>i;i++)t+=a.charCodeAt(i);return e.restrictDigits?a=this.convertToDigits(a,t,e.hashWordSize):(e.requireDigit&&(a=this.injectSpecialCharacter(a,0,4,t,e.hashWordSize,48,10)),e.requirePunctuation&&!e.restrictSpecial&&(a=this.injectSpecialCharacter(a,1,4,t,e.hashWordSize,33,15)),e.requireMixedCase&&(a=this.injectSpecialCharacter(a,2,4,t,e.hashWordSize,65,26),a=this.injectSpecialCharacter(a,3,4,t,e.hashWordSize,97,26)),e.restrictSpecial&&(a=this.removeSpecialCharacters(a,t,e.hashWordSize))),a.substr(0,e.hashWordSize)},PassHash.prototype.injectSpecialCharacter=function(e,a,t,i,r,s,n){for(var o,c,p,h,u,d=i%r,g=(d+a)%r,l=0;r-t>l;l++)if(o=(d+t+l)%r,c=e.charCodeAt(o),c>=s&&s+n>c)return e;return p=g>0?e.substring(0,g):"",h=String.fromCharCode((i+e.charCodeAt(g))%n+s),u=e.length>g+1?e.substring(g+1,e.length):"",p+h+u},PassHash.prototype.removeSpecialCharacters=function(e,a,t){for(var i,r="",s=0;t>s&&(i=e.substring(s).search(/[^a-z0-9]/i),!(0>i));)i>0&&(r+=e.substring(s,s+i)),r+=String.fromCharCode((a+s)%26+65),s+=i+1;return e.length>s&&(r+=e.substring(s)),r},PassHash.prototype.convertToDigits=function(e,a,t){for(var i,r="",s=0;t>s&&(i=e.substring(s).search(/[^0-9]/i),!(0>i));)i>0&&(r+=e.substring(s,s+i)),r+=String.fromCharCode((a+e.charCodeAt(s))%10+48),s+=i+1;return e.length>s&&(r+=e.substring(s)),r};var PassHash=new PassHash,app={updateHash:function(){var e={siteTag:$("#tag").val(),masterKey:$("#key").val(),hashWordSize:$("#hashWordSize").val(),requireDigit:$("#requireDigit").prop("checked"),requirePunctuation:$("#requirePunctuation").prop("checked"),requireMixedCase:$("#requireMixedCase").prop("checked"),restrictSpecial:$("#restrictSpecial").prop("checked"),restrictDigits:$("#restrictDigits").prop("checked")},a=PassHash.generateHashWord(e);""!==$("#tag").val()&&""!==$("#key").val()?$("#hash").val(a):$("#hash").val("")},showPassToggle:function(){var e=$("#pass-icon"),a=$("#key");"images/eye.png"==e.attr("src")?(e.attr("src","images/eye-red.png"),a.prop("type","text")):(e.attr("src","images/eye.png"),a.prop("type","password"))},updatePassText:function(){var e=$("#key"),a=$("#key-text");a.val(e.val())},openMenu:function(){var e=$("#main");e.find(".options").on("click",function(){e.toggleClass("open-menu")}),$("#app").on("swipeRight",function(){e.hasClass("open-service")?e.removeClass("open-service"):e.addClass("open-menu")}).on("swipeLeft",function(){e.hasClass("open-menu")?e.removeClass("open-menu"):e.addClass("open-service")})},changeService:function(e){var a=$("#main"),t=$("#tag"),i=$(".flip"),r=i.find(".front img"),s=i.find(".back img"),n=$(".service"),o=n.find("li"),c=o.length-1,p=void 0!==e?e:n.data("index")+1;if(!n.hasClass("service-rotate")){p>c&&(p=0),r.attr("src",s.attr("src")),s.attr("src",o.eq(p).find("img").attr("src")),n.addClass("service-rotate"),n.data("index",p);var h=o.hide().eq(p).show();a.removeClass().addClass(h.data("color")),t.val(h.data("tag")),app.updateHash()}},changeSize:function(){$("#hashWordSize").on("change",function(){$(this).prev().find("i").text($(this).val())})},events:function(){$("input.update").on("click",function(){app.updateHash()}),$("select.update").on("change",function(){app.updateHash()}),$("#tag").on("keyup",function(){app.updateHash()}),$("#key").on("keyup",function(){app.updatePassText(),app.updateHash()}),$("#tag").on("focus",function(){$(this).val(""),app.changeService(0)}),$(".service").on("click",function(){app.changeService()}).on("transitionend webkitTransitionEnd MSTransitionEnd oTransitionEnd",function(){$(this).removeClass("service-rotate")}),$("#services li").on("click",function(){app.changeService($(this).data("index"))})},init:function(){app.events(),app.openMenu(),app.changeSize()}};$(function(){FastClick.attach(document.body),app.init()});